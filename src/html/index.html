<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Proyectos - Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="../storage/vectors/browser-svgrepo-com.svg" alt="Logo" class="logo-icon">
                    <span class="logo-text">Panel de Control</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item active">
                        <a href="#" class="nav-link">
                            <img src="../storage/vectors/home-svgrepo-com.svg" alt="Inicio" class="nav-icon">
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="empleados.html" class="nav-link">
                            <img src="../storage/vectors/user-svgrepo-com.svg" alt="Empleados" class="nav-icon">
                            <span class="nav-text">Empleados</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="materiales.html" class="nav-link">
                            <img src="../storage/vectors/layers-svgrepo-com.svg" alt="Materiales" class="nav-icon">
                            <span class="nav-text">Materiales</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="otros-gastos.html" class="nav-link">
                            <img src="../storage/vectors/briefcase-svgrepo-com.svg" alt="Otros Gastos" class="nav-icon">
                            <span class="nav-text">Otros Gastos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="tareas.html" class="nav-link">
                            <img src="../storage/vectors/clipboard-svgrepo-com.svg" alt="Tareas" class="nav-icon">
                            <span class="nav-text">Tareas</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <button onclick="abrirModalConfiguracion()" class="nav-link settings-link">
                    <img src="../storage/vectors/settings-svgrepo-com.svg" alt="Configuración" class="nav-icon">
                    <span class="nav-text">Configuración</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Bienvenido al sistema de control de proyectos</p>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <img src="../storage/vectors/portrait-user-svgrepo-com.svg" alt="Usuario" class="user-avatar">
                        <span class="user-name">Administrador</span>
                    </div>
                </div>
            </header>

                         <!-- Dashboard Content -->
             <div class="dashboard-content">
                 <!-- Stats Cards -->
                 <div class="stats-section">
                     <h2 class="section-title">Estadísticas</h2>
                     <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <img src="../storage/vectors/user-svgrepo-com.svg" alt="Empleados" class="stat-icon-img">
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number" id="totalEmpleados">0</h3>
                                <p class="stat-label">Empleados</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <img src="../storage/vectors/layers-svgrepo-com.svg" alt="Materiales" class="stat-icon-img">
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number" id="totalMateriales">0</h3>
                                <p class="stat-label">Materiales</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <img src="../storage/vectors/clipboard-svgrepo-com.svg" alt="Tareas" class="stat-icon-img">
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number" id="totalTareas">0</h3>
                                <p class="stat-label">Tareas</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <img src="../storage/vectors/coins-svgrepo-com.svg" alt="Gastos" class="stat-icon-img">
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number" id="totalGastos">$0</h3>
                                <p class="stat-label">Total Gastos</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions-section">
                    <h2 class="section-title">Acciones Rápidas</h2>
                    <div class="quick-actions-grid">
                        <a href="empleados.html" class="quick-action-card">
                            <div class="action-icon">
                                <img src="../storage/vectors/user-svgrepo-com.svg" alt="Empleados" class="action-icon-img">
                            </div>
                            <h3>Gestionar Empleados</h3>
                            <p>Crear, editar y administrar empleados del proyecto</p>
                        </a>
                        
                        <a href="materiales.html" class="quick-action-card">
                            <div class="action-icon">
                                <img src="../storage/vectors/layers-svgrepo-com.svg" alt="Materiales" class="action-icon-img">
                            </div>
                            <h3>Gestionar Materiales</h3>
                            <p>Administrar inventario y costos de materiales</p>
                        </a>
                        
                        <a href="tareas.html" class="quick-action-card">
                            <div class="action-icon">
                                <img src="../storage/vectors/clipboard-svgrepo-com.svg" alt="Tareas" class="action-icon-img">
                            </div>
                            <h3>Gestionar Tareas</h3>
                            <p>Organizar y asignar tareas del proyecto</p>
                        </a>
                        
                        <a href="otros-gastos.html" class="quick-action-card">
                            <div class="action-icon">
                                <img src="../storage/vectors/briefcase-svgrepo-com.svg" alt="Gastos" class="action-icon-img">
                            </div>
                            <h3>Otros Gastos</h3>
                            <p>Registrar gastos adicionales del proyecto</p>
                        </a>
                    </div>
                </div>


            </div>
        </main>
    </div>

    <!-- Modal de Configuración -->
    <div id="modalConfiguracion" class="modal">
        <div class="modal-content config-modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <img src="../storage/vectors/settings-svgrepo-com.svg" alt="" class="settings-icon-large">
                    Configuración del Sistema
                </h2>
                <button onclick="cerrarModalConfiguracion()" class="modal-close">×</button>
            </div>
            
            <div class="modal-body config-content">
                <div class="config-panel">
                    <h2>
                        <img src="../storage/vectors/cash-register-svgrepo-com.svg" alt="" class="cash-register-icon">
                        Configuración de Rangos por Defecto
                    </h2>
                    <p>Define los rangos globales que se aplicarán en todo el sistema para validar costos y precios.</p>
                    
                    <div class="config-grid">
                        <div class="input-group">
                            <label for="rangoMinimoGlobal">
                                <img src="../storage/vectors/cash-register-svgrepo-com.svg" alt="" class="cash-register-icon"> 
                                Costo Mínimo Global ($)
                            </label>
                            <input type="number" id="rangoMinimoGlobal" value="1" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="input-group">
                            <label for="rangoMaximoGlobal">
                                <img src="../storage/vectors/cash-register-svgrepo-com.svg" alt="" class="cash-register-icon"> 
                                Costo Máximo Global ($)
                            </label>
                            <input type="number" id="rangoMaximoGlobal" value="1000" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="range-display-container">
                        <span id="rangoGlobalActual" class="range-display">
                            Rango global: $1.00 - $1000.00
                        </span>
                    </div>
                    
                    <button onclick="aplicarConfiguracionGlobal()" class="button button-success">
                        <img src="../storage/vectors/check-svgrepo-com.svg" alt="" class="button-icon">
                        Aplicar Configuración Global
                    </button>
                </div>

                <div class="config-panel">
                    <h2>
                        <img src="../storage/vectors/shield-svgrepo-com.svg" alt="" class="shield-icon">
                        Configuración de Validación
                    </h2>
                    <p>Personaliza las reglas de validación y la experiencia del usuario en el sistema.</p>
                    
                    <div class="config-grid">
                        <div class="input-group">
                            <label for="validacionEstricta">
                                <img src="../storage/vectors/lock-svgrepo-com.svg" alt="" class="lock-icon">
                                Validación Estricta de Nombres
                            </label>
                            <select id="validacionEstricta">
                                <option value="true">Activada (Recomendado)</option>
                                <option value="false">Desactivada</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="mostrarConsejos">
                                <img src="../storage/vectors/lightbulb-svgrepo-com.svg" alt="" class="lightbulb-icon">
                                Mostrar Consejos de Ayuda
                            </label>
                            <select id="mostrarConsejos">
                                <option value="true">Sí (Recomendado)</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="aplicarConfiguracionValidacion()" class="button button-info">
                        <img src="../storage/vectors/settings-svgrepo-com.svg" alt="" class="button-icon">
                        Aplicar Configuración de Validación
                    </button>
                </div>

                <div class="config-panel">
                    <h2>
                        <img src="../storage/vectors/database-svgrepo-com.svg" alt="" class="database-icon">
                        Gestión de Datos
                    </h2>
                    <p>Administra la configuración del sistema y los datos almacenados.</p>
                    
                    <div class="buttons-section">
                        <button onclick="exportarConfiguracion()" class="button button-success">
                            <img src="../storage/vectors/download-svgrepo-com.svg" alt="" class="button-icon">
                            Exportar Configuración
                        </button>
                        
                        <button onclick="resetearConfiguracion()" class="button button-warning">
                            <img src="../storage/vectors/refresh-svgrepo-com.svg" alt="" class="button-icon">
                            Restaurar Por Defecto
                        </button>
                        
                        <button onclick="limpiarDatosSistema()" class="button button-danger">
                            <img src="../storage/vectors/trash-svgrepo-com.svg" alt="" class="button-icon">
                            Limpiar Todos los Datos
                        </button>
                    </div>
                </div>

                <div class="config-panel">
                    <h2>
                        <img src="../storage/vectors/stats-svgrepo-com.svg" alt="" class="stats-icon">
                        Estadísticas del Sistema
                    </h2>
                    <p>Información detallada sobre el uso y estado del sistema.</p>
                    <div id="estadisticasSistema" class="stats-panel">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value primary" id="totalEmpleadosConfig">0</div>
                                <div class="stat-label">Empleados Registrados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value purple" id="totalMaterialesConfig">0</div>
                                <div class="stat-label">Materiales en Inventario</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value success" id="totalTareasConfig">0</div>
                                <div class="stat-label">Tareas Activas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value warning" id="totalGastosConfig">$0</div>
                                <div class="stat-label">Total de Gastos</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cerrar modal al hacer clic fuera de él
        window.onclick = function(event) {
            const modalConfig = document.getElementById('modalConfiguracion');
            if (event.target === modalConfig) {
                cerrarModalConfiguracion();
            }
        }

        // ===== FUNCIONES DE CONFIGURACIÓN GLOBAL =====
        let configuracionGlobal = {
            rangos: { minimo: 1, maximo: 1000 },
            validacion: { estricta: true, mostrarConsejos: true, caracteresProhibidos: `!"·$%&/()=?¿'¡+\`*]^[´.:,;-_{}<>\`~\\|` },
            interfaz: { tema: 'default', animaciones: true, idioma: 'es' },
            datos: { autoguardado: true, backupAutomatico: true }
        };

        function abrirModalConfiguracion() {
            cargarConfiguracionGlobal();
            document.getElementById('modalConfiguracion').style.display = 'block';
            actualizarInterfazConfiguracion();
            actualizarEstadisticasSistemaConfig();
        }

        function cerrarModalConfiguracion() {
            document.getElementById('modalConfiguracion').style.display = 'none';
        }

        // Cargar configuración desde localStorage
        function cargarConfiguracionGlobal() {
            const configGuardada = localStorage.getItem('configuracionSistema');
            if (configGuardada) {
                try {
                    configuracionGlobal = { ...configuracionGlobal, ...JSON.parse(configGuardada) };
                } catch (error) {
                    console.warn('Error al cargar configuración guardada:', error);
                }
            }
        }

        function actualizarInterfazConfiguracion() {
            cargarConfiguracionGlobal();
            document.getElementById('rangoMinimoGlobal').value = configuracionGlobal.rangos.minimo;
            document.getElementById('rangoMaximoGlobal').value = configuracionGlobal.rangos.maximo;
            actualizarRangoGlobalMostrado();
        }

        function actualizarRangoGlobalMostrado() {
            const minimo = parseFloat(document.getElementById('rangoMinimoGlobal').value) || 0;
            const maximo = parseFloat(document.getElementById('rangoMaximoGlobal').value) || 999999;
            document.getElementById('rangoGlobalActual').textContent = `Rango global: $${minimo.toFixed(2)} - $${maximo.toFixed(2)}`;
        }

        function aplicarConfiguracionGlobal() {
            const minimo = parseFloat(document.getElementById('rangoMinimoGlobal').value);
            const maximo = parseFloat(document.getElementById('rangoMaximoGlobal').value);
            
            if (minimo >= maximo) {
                alert("⚠️ Error: El valor mínimo debe ser menor que el máximo");
                return;
            }
            
            configuracionGlobal.rangos.minimo = minimo;
            configuracionGlobal.rangos.maximo = maximo;
            
            // Guardar en localStorage
            localStorage.setItem('configuracionSistema', JSON.stringify(configuracionGlobal));
            localStorage.setItem('rangosGlobales', JSON.stringify({
                minimo: minimo,
                maximo: maximo
            }));
            
            actualizarRangoGlobalMostrado();
            
            alert(`✅ Configuración global aplicada:\nRango: $${minimo.toFixed(2)} - $${maximo.toFixed(2)}\n\n` +
                  `Se aplicará a:\n• Empleados (costo por hora)\n• Materiales (costo por unidad)\n• Otros costos`);
        }

        function aplicarConfiguracionValidacion() {
            alert('✅ Configuración de validación aplicada');
        }

        function exportarConfiguracion() {
            alert('📤 Configuración exportada');
        }

        function resetearConfiguracion() {
            alert('🔄 Configuración restaurada');
        }

        function limpiarDatosSistema() {
            alert('Datos del sistema eliminados');
        }

        function actualizarEstadisticasSistemaConfig() {
            // Cargar estadísticas desde localStorage
            const empleados = JSON.parse(localStorage.getItem('empleadosCreados')) || [];
            const materiales = JSON.parse(localStorage.getItem('materialesCreados')) || [];
            const tareas = JSON.parse(localStorage.getItem('tareasCreadas')) || [];
            const otrosGastos = JSON.parse(localStorage.getItem('otrosGastosCreados')) || [];
            
            // Actualizar contadores en el modal
            document.getElementById('totalEmpleadosConfig').textContent = empleados.length;
            document.getElementById('totalMaterialesConfig').textContent = materiales.length;
            document.getElementById('totalTareasConfig').textContent = tareas.length;
            
            // Calcular total de gastos
            const totalGastos = otrosGastos.reduce((total, item) => {
                const gasto = item.otroGasto;
                return total + parseFloat(gasto.costoPorUnidad || 0);
            }, 0);
            document.getElementById('totalGastosConfig').textContent = `$${totalGastos.toFixed(2)}`;
        }

        // ===== FUNCIONES DEL DASHBOARD =====
        function cargarEstadisticasDashboard() {
            // Cargar estadísticas desde localStorage
            const empleados = JSON.parse(localStorage.getItem('empleadosCreados')) || [];
            const materiales = JSON.parse(localStorage.getItem('materialesCreados')) || [];
            const tareas = JSON.parse(localStorage.getItem('tareasCreadas')) || [];
            const otrosGastos = JSON.parse(localStorage.getItem('otrosGastosCreados')) || [];
            
            // Actualizar contadores
            document.getElementById('totalEmpleados').textContent = empleados.length;
            document.getElementById('totalMateriales').textContent = materiales.length;
            document.getElementById('totalTareas').textContent = tareas.length;
            
            // Calcular total de gastos
            const totalGastos = otrosGastos.reduce((total, item) => {
                const gasto = item.otroGasto;
                return total + parseFloat(gasto.costoPorUnidad || 0);
            }, 0);
            document.getElementById('totalGastos').textContent = `$${totalGastos.toFixed(2)}`;
            
            // Log temporal para verificar
            console.log('Dashboard Stats:', {
                empleados: empleados.length,
                materiales: materiales.length,
                tareas: tareas.length,
                gastos: totalGastos,
                empleadosData: empleados
            });
        }

        // Función para actualizar estadísticas desde otras páginas
        function actualizarEstadisticasDashboard() {
            cargarEstadisticasDashboard();
        }

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            cargarEstadisticasDashboard();
        });

        // Actualizar estadísticas cuando la página se vuelve visible
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                cargarEstadisticasDashboard();
            }
        });

        // Actualizar estadísticas cuando se enfoca la ventana
        window.addEventListener('focus', function() {
            cargarEstadisticasDashboard();
        });

        // Actualizar estadísticas cada 1 segundo
        setInterval(cargarEstadisticasDashboard, 1000);

        // Actualizar estadísticas cuando se hace clic en cualquier lugar
        document.addEventListener('click', function() {
            cargarEstadisticasDashboard();
        });

        // Actualizar estadísticas cuando se presiona cualquier tecla
        document.addEventListener('keydown', function() {
            cargarEstadisticasDashboard();
        });
    </script>
</body>
</html>